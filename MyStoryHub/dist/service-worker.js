const CACHE_NAME="Mystoryhub-v1",urlsToCache=["/","/index.html","/logo.png","/manifest.json","/scripts/index.js","/styles/base.css","/styles/buttons.css","/styles/forms.css","/styles/header.css","/styles/footer.css","/styles/home.css","/styles/story-items.css","/styles/story-details.css","/styles/add-story.css","/styles/maps.css","/styles/profile.css","/styles/favorite.css","/styles/loader.css","/styles/beranda.css","/styles/not-found.css","/styles/responsive.css","/images/placeholder-image.jpg","/images/icon-x144.png","/images/icons/maskable-icon-x48.png","/images/icons/maskable-icon-x96.png","/images/icons/maskable-icon-x192.png","/images/icons/maskable-icon-x384.png","/images/icons/maskable-icon-x512.png","https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"];self.addEventListener("install",(s=>{s.waitUntil(caches.open(CACHE_NAME).then((s=>(console.log("Cache dibuka"),s.addAll(urlsToCache)))))})),self.addEventListener("activate",(s=>{s.waitUntil(caches.keys().then((s=>Promise.all(s.filter((s=>s!==CACHE_NAME)).map((s=>caches.delete(s)))))))})),self.addEventListener("fetch",(s=>{new URL(s.request.url).origin===location.origin?s.respondWith(caches.match(s.request).then((e=>{const t=fetch(s.request).then((e=>{if(e&&200===e.status){const t=e.clone();caches.open(CACHE_NAME).then((e=>{e.put(s.request,t)}))}return e})).catch((e=>(console.error("Fetch gagal:",e),"navigate"===s.request.mode?caches.match("/offline.html"):null)));return e||t}))):s.respondWith(fetch(s.request).then((s=>s)).catch((()=>caches.match(s.request))))})),self.addEventListener("push",(s=>{let e={title:"Notifikasi Baru",options:{body:"Ada pembaruan dari MyStoryHub: ${description}",icon:"/images/icon-x144.png"}};if(s.data)try{const t=s.data.json();e={title:t.title||e.title,options:{...e.options,body:`Anda telah membuat story baru dengan deskripsi: ${description||"Deskripsi tidak tersedia"}`,data:{url:t.url||"/"}}}}catch(s){console.error("Gagal memproses data notifikasi:",s)}s.waitUntil(self.registration.showNotification(e.title,e.options))})),self.addEventListener("notificationclick",(s=>{s.notification.close();const e=s.notification.data?.url||"/";s.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((s=>{s.some((s=>s.url===e&&(s.focus(),!0)))||clients.openWindow(e).catch((s=>{console.error("Gagal membuka jendela:",s)}))})))}));